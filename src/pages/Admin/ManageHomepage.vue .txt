<!-- src/pages/Admin/ManageHomepage.vue -->
<template>
  <div class="admin-homepage-management">
    <!-- Page Header -->
    <div class="mb-8">
      <h1 class="text-2xl lg:text-3xl font-display-en font-bold text-gray-900 mb-2">
        {{ safeTranslate('Homepage Management') }}
      </h1>
      <p class="text-gray-600">
        {{ safeTranslate('Manage homepage content, featured brands, and exclusive offers') }}
      </p>
    </div>

    <!-- Loading State -->
    <div v-if="homepageStore.isLoading" class="text-center py-12">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"></div>
      <p class="mt-4 text-gray-600">{{ safeTranslate('Loading homepage data...') }}</p>
    </div>

    <!-- Error State -->
    <div v-else-if="homepageStore.error" class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
      <p class="text-red-700">{{ homepageStore.error }}</p>
      <button @click="loadHomepageData" class="mt-2 text-primary-600 hover:text-primary-700">
        {{ safeTranslate('Retry') }}
      </button>
    </div>

    <!-- Main Content -->
    <div v-else class="space-y-8">
      <!-- Hero Banner Section -->
      <div class="bg-white rounded-xl shadow-luxury-sm border border-gray-200 p-6">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-lg font-display-en font-bold text-gray-900">
            {{ safeTranslate('Hero Banner') }}
          </h2>
          <button
            @click="editingHeroBanner = !editingHeroBanner"
            class="text-primary-600 hover:text-primary-700 text-sm font-medium flex items-center gap-2"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
            </svg>
            {{ editingHeroBanner ? safeTranslate('Cancel') : safeTranslate('Edit') }}
          </button>
        </div>

        <!-- Display Current Hero Banner -->
        <div v-if="!editingHeroBanner" class="space-y-4">
          <div class="relative h-48 rounded-lg overflow-hidden">
            <img 
              :src="homepageStore.homepageData.heroBanner.imageUrl || '/images/banner.jpg'" 
              :alt="homepageStore.homepageData.heroBanner.title"
              class="w-full h-full object-cover"
            />
            <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent flex items-end p-4">
              <div>
                <h3 class="text-white text-xl font-bold">
                  {{ homepageStore.homepageData.heroBanner.title || 'Luxury Perfumes' }}
                </h3>
                <p class="text-white/80 text-sm">
                  {{ homepageStore.homepageData.heroBanner.subtitle || 'Premium Collection' }}
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Edit Hero Banner Form -->
        <form v-else @submit.prevent="updateHeroBanner" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              {{ safeTranslate('Banner Image URL') }}
            </label>
            <input
              v-model="heroBannerForm.imageUrl"
              type="text"
              placeholder="https://example.com/image.jpg"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
            />
            <p class="text-xs text-gray-500 mt-1">
              {{ safeTranslate('Recommended size: 1600×900px') }}
            </p>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              {{ safeTranslate('Banner Title') }}
            </label>
            <input
              v-model="heroBannerForm.title"
              type="text"
              placeholder="Luxury Perfumes"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
            />
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              {{ safeTranslate('Banner Subtitle') }}
            </label>
            <input
              v-model="heroBannerForm.subtitle"
              type="text"
              placeholder="Premium Collection"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
            />
          </div>
          
          <div class="flex justify-end gap-3 pt-4">
            <button
              type="button"
              @click="editingHeroBanner = false"
              class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"
            >
              {{ safeTranslate('Cancel') }}
            </button>
            <button
              type="submit"
              :disabled="saving"
              class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <span v-if="saving" class="flex items-center gap-2">
                <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
                {{ safeTranslate('Saving...') }}
              </span>
              <span v-else>
                {{ safeTranslate('Save Changes') }}
              </span>
            </button>
          </div>
        </form>
      </div>

      <!-- Featured Brands Management -->
      <div class="bg-white rounded-xl shadow-luxury-sm border border-gray-200 p-6">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-lg font-display-en font-bold text-gray-900">
            {{ safeTranslate('Featured Brands') }}
            <span class="text-sm font-normal text-gray-500 ml-2">
              ({{ homepageStore.homepageData.featuredBrands.length }} brands)
            </span>
          </h2>
          <button
            @click="showAddBrandModal = true"
            class="px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-lg hover:bg-primary-700 flex items-center gap-2"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            {{ safeTranslate('Add Brand') }}
          </button>
        </div>

        <!-- Brands Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div
            v-for="(brand, index) in homepageStore.homepageData.featuredBrands"
            :key="brand.id"
            class="border border-gray-200 rounded-lg p-4 hover:border-primary-500 transition-colors"
          >
            <div class="flex items-start gap-3">
              <div class="w-16 h-16 rounded-lg overflow-hidden flex-shrink-0">
                <img
                  :src="brand.image"
                  :alt="brand.name"
                  class="w-full h-full object-cover"
                />
              </div>
              <div class="flex-1 min-w-0">
                <h3 class="font-medium text-gray-900 truncate">{{ brand.name }}</h3>
                <p class="text-sm text-gray-600 truncate">{{ brand.signature }}</p>
                <p class="text-sm text-primary-600 font-medium mt-1">{{ brand.price }} {{ safeTranslate('currencyLE') }}</p>
              </div>
              <div class="flex items-center gap-1">
                <button
                  @click="editBrand(index)"
                  class="p-1 text-gray-500 hover:text-primary-600"
                  :title="safeTranslate('Edit')"
                >
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                  </svg>
                </button>
                <button
                  @click="deleteBrand(index)"
                  class="p-1 text-gray-500 hover:text-red-600"
                  :title="safeTranslate('Delete')"
                >
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                  </svg>
                </button>
                <div class="flex flex-col gap-0.5 ml-1">
                  <button
                    v-if="index > 0"
                    @click="moveBrandUp(index)"
                    class="p-0.5 text-gray-400 hover:text-primary-600"
                    :title="safeTranslate('Move Up')"
                  >
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/>
                    </svg>
                  </button>
                  <button
                    v-if="index < homepageStore.homepageData.featuredBrands.length - 1"
                    @click="moveBrandDown(index)"
                    class="p-0.5 text-gray-400 hover:text-primary-600"
                    :title="safeTranslate('Move Down')"
                  >
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- No Brands Message -->
        <div
          v-if="homepageStore.homepageData.featuredBrands.length === 0"
          class="text-center py-8 text-gray-500"
        >
          <svg class="w-12 h-12 mx-auto mb-3 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
          </svg>
          <p>{{ safeTranslate('No featured brands added yet') }}</p>
        </div>
      </div>

      <!-- Today's Exclusive Offer -->
      <div class="bg-white rounded-xl shadow-luxury-sm border border-gray-200 p-6">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-lg font-display-en font-bold text-gray-900">
            {{ safeTranslate('Today\'s Exclusive Offer') }}
          </h2>
          <button
            @click="showAddOfferModal = true"
            class="px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-lg hover:bg-primary-700 flex items-center gap-2"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            {{ homepageStore.homepageData.activeOffers.length > 0 ? safeTranslate('Edit Offer') : safeTranslate('Add Offer') }}
          </button>
        </div>

        <!-- Current Offer -->
        <div v-if="homepageStore.homepageData.activeOffers.length > 0">
          <div class="border border-primary-200 rounded-lg p-6 bg-gradient-to-r from-primary-50 to-white">
            <div class="flex flex-col md:flex-row items-center gap-6">
              <div class="w-32 h-40 rounded-lg overflow-hidden flex-shrink-0">
                <img
                  :src="homepageStore.homepageData.activeOffers[0].imageUrl"
                  :alt="homepageStore.homepageData.activeOffers[0].title"
                  class="w-full h-full object-cover"
                />
              </div>
              <div class="flex-1">
                <h3 class="text-xl font-bold text-gray-900">
                  {{ homepageStore.homepageData.activeOffers[0].title }}
                </h3>
                <p class="text-gray-600 mt-1">
                  {{ homepageStore.homepageData.activeOffers[0].subtitle }}
                </p>
                <div class="flex items-center gap-4 mt-4">
                  <span class="text-2xl font-bold text-primary-600">
                    {{ homepageStore.homepageData.activeOffers[0].newPrice }} {{ safeTranslate('currencyLE') }}
                  </span>
                  <span class="text-lg text-gray-400 line-through">
                    {{ homepageStore.homepageData.activeOffers[0].oldPrice }} {{ safeTranslate('currencyLE') }}
                  </span>
                </div>
                <div class="mt-4 flex items-center gap-3">
                  <button
                    @click="editOffer(0)"
                    class="px-4 py-2 bg-white border border-primary-600 text-primary-600 rounded-lg hover:bg-primary-50"
                  >
                    {{ safeTranslate('Edit Offer') }}
                  </button>
                  <button
                    @click="removeOffer(0)"
                    class="px-4 py-2 bg-red-50 border border-red-200 text-red-600 rounded-lg hover:bg-red-100"
                  >
                    {{ safeTranslate('Remove Offer') }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- No Offer Message -->
        <div
          v-else
          class="text-center py-8 text-gray-500"
        >
          <svg class="w-12 h-12 mx-auto mb-3 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/>
          </svg>
          <p>{{ safeTranslate('No active offer') }}</p>
          <p class="text-sm mt-1">{{ safeTranslate('Add an exclusive offer to showcase on the homepage') }}</p>
        </div>
      </div>

      <!-- Marquee Brands -->
      <div class="bg-white rounded-xl shadow-luxury-sm border border-gray-200 p-6">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-lg font-display-en font-bold text-gray-900">
            {{ safeTranslate('Marquee Brands') }}
            <span class="text-sm font-normal text-gray-500 ml-2">
              ({{ homepageStore.homepageData.marqueeBrands.length }} logos)
            </span>
          </h2>
          <button
            @click="showAddMarqueeBrandModal = true"
            class="px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-lg hover:bg-primary-700 flex items-center gap-2"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            {{ safeTranslate('Add Brand Logo') }}
          </button>
        </div>

        <!-- Marquee Brands Preview -->
        <div class="border border-gray-200 rounded-lg p-4 bg-gray-50 overflow-x-auto">
          <div class="flex gap-4 min-w-max">
            <div
              v-for="(brand, index) in homepageStore.homepageData.marqueeBrands"
              :key="brand.id"
              class="flex-shrink-0"
            >
              <div class="relative group">
                <div class="w-24 h-16 bg-white rounded-lg border border-gray-200 p-2 flex items-center justify-center">
                  <img
                    :src="brand.logo"
                    :alt="brand.name"
                    class="max-w-full max-h-full object-contain"
                  />
                </div>
                <div class="absolute -top-2 -right-2 opacity-0 group-hover:opacity-100 transition-opacity">
                  <button
                    @click="deleteMarqueeBrand(index)"
                    class="w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600"
                  >
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                  </button>
                </div>
              </div>
              <p class="text-xs text-gray-600 text-center mt-2 truncate">{{ brand.name }}</p>
            </div>
          </div>
        </div>

        <!-- No Marquee Brands Message -->
        <div
          v-if="homepageStore.homepageData.marqueeBrands.length === 0"
          class="text-center py-8 text-gray-500"
        >
          <svg class="w-12 h-12 mx-auto mb-3 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
          <p>{{ safeTranslate('No marquee brands added') }}</p>
        </div>
      </div>
    </div>

    <!-- Add/Edit Brand Modal -->
    <div v-if="showAddBrandModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div class="bg-white rounded-xl shadow-luxury-xl max-w-md w-full p-6">
        <h2 class="text-xl font-display-en font-bold text-gray-900 mb-4">
          {{ editingBrandIndex !== null ? safeTranslate('Edit Brand') : safeTranslate('Add New Brand') }}
        </h2>
        
        <form @submit.prevent="saveBrand" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              {{ safeTranslate('Brand Name') }} *
            </label>
            <input
              v-model="brandForm.name"
              type="text"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
              required
            />
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              {{ safeTranslate('Signature/Description') }}
            </label>
            <input
              v-model="brandForm.signature"
              type="text"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
            />
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              {{ safeTranslate('Image URL') }} *
            </label>
            <input
              v-model="brandForm.image"
              type="text"
              placeholder="https://example.com/image.jpg"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
              required
            />
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              {{ safeTranslate('Slug') }} *
            </label>
            <input
              v-model="brandForm.slug"
              type="text"
              placeholder="brand-name"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
              required
            />
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              {{ safeTranslate('Price') }} ({{ safeTranslate('currencyLE') }}) *
            </label>
            <input
              v-model="brandForm.price"
              type="number"
              min="0"
              step="0.01"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
              required
            />
          </div>
          
          <div class="flex justify-end gap-3 pt-4">
            <button
              type="button"
              @click="cancelBrandEdit"
              class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"
            >
              {{ safeTranslate('Cancel') }}
            </button>
            <button
              type="submit"
              :disabled="savingBrand"
              class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <span v-if="savingBrand" class="flex items-center gap-2">
                <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
                {{ safeTranslate('Saving...') }}
              </span>
              <span v-else>
                {{ editingBrandIndex !== null ? safeTranslate('Update Brand') : safeTranslate('Add Brand') }}
              </span>
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Add/Edit Offer Modal -->
    <div v-if="showAddOfferModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div class="bg-white rounded-xl shadow-luxury-xl max-w-md w-full p-6">
        <h2 class="text-xl font-display-en font-bold text-gray-900 mb-4">
          {{ editingOfferIndex !== null ? safeTranslate('Edit Offer') : safeTranslate('Add New Offer') }}
        </h2>
        
        <form @submit.prevent="saveOffer" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              {{ safeTranslate('Product Title') }} *
            </label>
            <input
              v-model="offerForm.title"
              type="text"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
              required
            />
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              {{ safeTranslate('Subtitle/Description') }}
            </label>
            <input
              v-model="offerForm.subtitle"
              type="text"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
            />
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              {{ safeTranslate('Image URL') }} *
            </label>
            <input
              v-model="offerForm.imageUrl"
              type="text"
              placeholder="https://example.com/image.jpg"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
              required
            />
          </div>
          
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">
                {{ safeTranslate('Original Price') }} ({{ safeTranslate('currencyLE') }}) *
              </label>
              <input
                v-model="offerForm.oldPrice"
                type="number"
                min="0"
                step="0.01"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                required
              />
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">
                {{ safeTranslate('Discounted Price') }} ({{ safeTranslate('currencyLE') }}) *
              </label>
              <input
                v-model="offerForm.newPrice"
                type="number"
                min="0"
                step="0.01"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                required
              />
            </div>
          </div>
          
          <div class="flex justify-end gap-3 pt-4">
            <button
              type="button"
              @click="cancelOfferEdit"
              class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"
            >
              {{ safeTranslate('Cancel') }}
            </button>
            <button
              type="submit"
              :disabled="savingOffer"
              class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <span v-if="savingOffer" class="flex items-center gap-2">
                <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
                {{ safeTranslate('Saving...') }}
              </span>
              <span v-else>
                {{ editingOfferIndex !== null ? safeTranslate('Update Offer') : safeTranslate('Add Offer') }}
              </span>
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Add Marquee Brand Modal -->
    <div v-if="showAddMarqueeBrandModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div class="bg-white rounded-xl shadow-luxury-xl max-w-md w-full p-6">
        <h2 class="text-xl font-display-en font-bold text-gray-900 mb-4">
          {{ safeTranslate('Add Brand Logo for Marquee') }}
        </h2>
        
        <form @submit.prevent="addMarqueeBrand" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              {{ safeTranslate('Brand Name') }} *
            </label>
            <input
              v-model="marqueeBrandForm.name"
              type="text"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
              required
            />
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              {{ safeTranslate('Logo URL') }} *
            </label>
            <input
              v-model="marqueeBrandForm.logo"
              type="text"
              placeholder="https://example.com/logo.png"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
              required
            />
            <p class="text-xs text-gray-500 mt-1">
              {{ safeTranslate('Recommended: White or transparent background, PNG format') }}
            </p>
          </div>
          
          <div class="flex justify-end gap-3 pt-4">
            <button
              type="button"
              @click="showAddMarqueeBrandModal = false"
              class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"
            >
              {{ safeTranslate('Cancel') }}
            </button>
            <button
              type="submit"
              :disabled="savingMarqueeBrand"
              class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <span v-if="savingMarqueeBrand" class="flex items-center gap-2">
                <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
                {{ safeTranslate('Adding...') }}
              </span>
              <span v-else>
                {{ safeTranslate('Add Brand') }}
              </span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, onMounted } from 'vue'
import { useHomepageStore } from '@/stores/homepage'
import { useLanguageStore } from '@/stores/language'
import { useAuthStore } from '@/stores/auth'
import { useRouter } from 'vue-router'

const homepageStore = useHomepageStore()
const languageStore = useLanguageStore()
const authStore = useAuthStore()
const router = useRouter()

// Check if user is super admin
if (authStore.user?.role !== 'super-admin') {
  router.push('/admin')
}

// Editing states
const editingHeroBanner = ref(false)
const showAddBrandModal = ref(false)
const showAddOfferModal = ref(false)
const showAddMarqueeBrandModal = ref(false)
const editingBrandIndex = ref<number | null>(null)
const editingOfferIndex = ref<number | null>(null)

// Loading states
const saving = ref(false)
const savingBrand = ref(false)
const savingOffer = ref(false)
const savingMarqueeBrand = ref(false)

// Form data
const heroBannerForm = reactive({
  imageUrl: '',
  title: '',
  subtitle: ''
})

const brandForm = reactive({
  name: '',
  signature: '',
  image: '',
  slug: '',
  price: 0
})

const offerForm = reactive({
  title: '',
  subtitle: '',
  imageUrl: '',
  oldPrice: 0,
  newPrice: 0
})

const marqueeBrandForm = reactive({
  name: '',
  logo: ''
})

// Translations
const appTranslations = {
  'Homepage Management': { en: 'Homepage Management', ar: 'إدارة الصفحة الرئيسية' },
  'Manage homepage content, featured brands, and exclusive offers': { en: 'Manage homepage content, featured brands, and exclusive offers', ar: 'إدارة محتوى الصفحة الرئيسية، العلامات التجارية المميزة، والعروض الحصرية' },
  'Loading homepage data...': { en: 'Loading homepage data...', ar: 'جاري تحميل بيانات الصفحة الرئيسية...' },
  'Retry': { en: 'Retry', ar: 'إعادة المحاولة' },
  'Hero Banner': { en: 'Hero Banner', ar: 'بانر الرئيسية' },
  'Edit': { en: 'Edit', ar: 'تعديل' },
  'Cancel': { en: 'Cancel', ar: 'إلغاء' },
  'Banner Image URL': { en: 'Banner Image URL', ar: 'رابط صورة البانر' },
  'Recommended size: 1600×900px': { en: 'Recommended size: 1600×900px', ar: 'الحجم الموصى به: 1600×900 بكسل' },
  'Banner Title': { en: 'Banner Title', ar: 'عنوان البانر' },
  'Banner Subtitle': { en: 'Banner Subtitle', ar: 'العنوان الفرعي للبانر' },
  'Saving...': { en: 'Saving...', ar: 'جاري الحفظ...' },
  'Save Changes': { en: 'Save Changes', ar: 'حفظ التغييرات' },
  'Featured Brands': { en: 'Featured Brands', ar: 'العلامات التجارية المميزة' },
  'Add Brand': { en: 'Add Brand', ar: 'إضافة علامة تجارية' },
  'currencyLE': { en: 'EGP', ar: 'ج.م' },
  'Delete': { en: 'Delete', ar: 'حذف' },
  'Move Up': { en: 'Move Up', ar: 'تحريك لأعلى' },
  'Move Down': { en: 'Move Down', ar: 'تحريك لأسفل' },
  'No featured brands added yet': { en: 'No featured brands added yet', ar: 'لم تتم إضافة علامات تجارية مميزة بعد' },
  'Today\'s Exclusive Offer': { en: 'Today\'s Exclusive Offer', ar: 'العرض الحصري اليوم' },
  'Edit Offer': { en: 'Edit Offer', ar: 'تعديل العرض' },
  'Add Offer': { en: 'Add Offer', ar: 'إضافة عرض' },
  'Remove Offer': { en: 'Remove Offer', ar: 'إزالة العرض' },
  'No active offer': { en: 'No active offer', ar: 'لا يوجد عرض نشط' },
  'Add an exclusive offer to showcase on the homepage': { en: 'Add an exclusive offer to showcase on the homepage', ar: 'أضف عرضًا حصريًا لعرضه على الصفحة الرئيسية' },
  'Marquee Brands': { en: 'Marquee Brands', ar: 'علامات الشريط المتحرك' },
  'Add Brand Logo': { en: 'Add Brand Logo', ar: 'إضافة شعار علامة تجارية' },
  'No marquee brands added': { en: 'No marquee brands added', ar: 'لم تتم إضافة علامات للشريط المتحرك' },
  'Edit Brand': { en: 'Edit Brand', ar: 'تعديل العلامة التجارية' },
  'Add New Brand': { en: 'Add New Brand', ar: 'إضافة علامة تجارية جديدة' },
  'Brand Name': { en: 'Brand Name', ar: 'اسم العلامة التجارية' },
  'Signature/Description': { en: 'Signature/Description', ar: 'التوقيع/الوصف' },
  'Image URL': { en: 'Image URL', ar: 'رابط الصورة' },
  'Slug': { en: 'Slug', ar: 'المعرف' },
  'Price': { en: 'Price', ar: 'السعر' },
  'Update Brand': { en: 'Update Brand', ar: 'تحديث العلامة التجارية' },
  'Edit Offer': { en: 'Edit Offer', ar: 'تعديل العرض' },
  'Add New Offer': { en: 'Add New Offer', ar: 'إضافة عرض جديد' },
  'Product Title': { en: 'Product Title', ar: 'عنوان المنتج' },
  'Subtitle/Description': { en: 'Subtitle/Description', ar: 'العنوان الفرعي/الوصف' },
  'Original Price': { en: 'Original Price', ar: 'السعر الأصلي' },
  'Discounted Price': { en: 'Discounted Price', ar: 'السعر بعد الخصم' },
  'Update Offer': { en: 'Update Offer', ar: 'تحديث العرض' },
  'Add Brand Logo for Marquee': { en: 'Add Brand Logo for Marquee', ar: 'إضافة شعار علامة تجارية للشريط المتحرك' },
  'Logo URL': { en: 'Logo URL', ar: 'رابط الشعار' },
  'Recommended: White or transparent background, PNG format': { en: 'Recommended: White or transparent background, PNG format', ar: 'مُستحسن: خلفية بيضاء أو شفافة، بصيغة PNG' },
  'Adding...': { en: 'Adding...', ar: 'جاري الإضافة...' },
  'Add Brand': { en: 'Add Brand', ar: 'إضافة علامة تجارية' }
}

const safeTranslate = (key: string) => {
  try {
    const translations = appTranslations[key as keyof typeof appTranslations]
    if (!translations) return key
    
    if (languageStore.t) {
      return languageStore.t(translations) || translations.en || key
    }
    return translations[languageStore.currentLanguage] || translations.en || key
  } catch (error) {
    console.warn('Translation error:', error)
    return key
  }
}

// Load homepage data
const loadHomepageData = async () => {
  await homepageStore.loadHomepageData()
  
  // Initialize form with current data
  Object.assign(heroBannerForm, homepageStore.homepageData.heroBanner)
}

// Update hero banner
const updateHeroBanner = async () => {
  saving.value = true
  try {
    await homepageStore.updateHeroBanner(heroBannerForm)
    editingHeroBanner.value = false
    showNotification('success', safeTranslate('Hero banner updated successfully'))
  } catch (error) {
    showNotification('error', safeTranslate('Failed to update hero banner'))
  } finally {
    saving.value = false
  }
}

// Brand management
const editBrand = (index: number) => {
  const brand = homepageStore.homepageData.featuredBrands[index]
  Object.assign(brandForm, brand)
  editingBrandIndex.value = index
  showAddBrandModal.value = true
}

const deleteBrand = async (index: number) => {
  if (!confirm(safeTranslate('Are you sure you want to delete this brand?'))) return
  
  const brands = [...homepageStore.homepageData.featuredBrands]
  brands.splice(index, 1)
  
  try {
    await homepageStore.updateFeaturedBrands(brands)
    showNotification('success', safeTranslate('Brand deleted successfully'))
  } catch (error) {
    showNotification('error', safeTranslate('Failed to delete brand'))
  }
}

const moveBrandUp = async (index: number) => {
  const brands = [...homepageStore.homepageData.featuredBrands]
  if (index > 0) {
    const temp = brands[index]
    brands[index] = brands[index - 1]
    brands[index - 1] = temp
    
    try {
      await homepageStore.updateFeaturedBrands(brands)
    } catch (error) {
      showNotification('error', safeTranslate('Failed to move brand'))
    }
  }
}

const moveBrandDown = async (index: number) => {
  const brands = [...homepageStore.homepageData.featuredBrands]
  if (index < brands.length - 1) {
    const temp = brands[index]
    brands[index] = brands[index + 1]
    brands[index + 1] = temp
    
    try {
      await homepageStore.updateFeaturedBrands(brands)
    } catch (error) {
      showNotification('error', safeTranslate('Failed to move brand'))
    }
  }
}

const saveBrand = async () => {
  savingBrand.value = true
  try {
    const brands = [...homepageStore.homepageData.featuredBrands]
    
    if (editingBrandIndex.value !== null) {
      // Update existing brand
      brands[editingBrandIndex.value] = {
        ...brandForm,
        id: brands[editingBrandIndex.value].id
      }
    } else {
      // Add new brand
      brands.push({
        ...brandForm,
        id: Date.now().toString()
      })
    }
    
    await homepageStore.updateFeaturedBrands(brands)
    showAddBrandModal.value = false
    resetBrandForm()
    showNotification('success', safeTranslate('Brand saved successfully'))
  } catch (error) {
    showNotification('error', safeTranslate('Failed to save brand'))
  } finally {
    savingBrand.value = false
  }
}

const cancelBrandEdit = () => {
  showAddBrandModal.value = false
  resetBrandForm()
}

const resetBrandForm = () => {
  editingBrandIndex.value = null
  Object.assign(brandForm, {
    name: '',
    signature: '',
    image: '',
    slug: '',
    price: 0
  })
}

// Offer management
const editOffer = (index: number) => {
  const offer = homepageStore.homepageData.activeOffers[index]
  Object.assign(offerForm, offer)
  editingOfferIndex.value = index
  showAddOfferModal.value = true
}

const removeOffer = async (index: number) => {
  if (!confirm(safeTranslate('Are you sure you want to remove this offer?'))) return
  
  try {
    await homepageStore.updateActiveOffers([])
    showNotification('success', safeTranslate('Offer removed successfully'))
  } catch (error) {
    showNotification('error', safeTranslate('Failed to remove offer'))
  }
}

const saveOffer = async () => {
  savingOffer.value = true
  try {
    const offers = []
    
    if (editingOfferIndex.value !== null) {
      // Update existing offer
      offers[editingOfferIndex.value] = {
        ...offerForm,
        id: homepageStore.homepageData.activeOffers[editingOfferIndex.value].id
      }
    } else {
      // Add new offer
      offers.push({
        ...offerForm,
        id: Date.now().toString()
      })
    }
    
    await homepageStore.updateActiveOffers(offers)
    showAddOfferModal.value = false
    resetOfferForm()
    showNotification('success', safeTranslate('Offer saved successfully'))
  } catch (error) {
    showNotification('error', safeTranslate('Failed to save offer'))
  } finally {
    savingOffer.value = false
  }
}

const cancelOfferEdit = () => {
  showAddOfferModal.value = false
  resetOfferForm()
}

const resetOfferForm = () => {
  editingOfferIndex.value = null
  Object.assign(offerForm, {
    title: '',
    subtitle: '',
    imageUrl: '',
    oldPrice: 0,
    newPrice: 0
  })
}

// Marquee brand management
const addMarqueeBrand = async () => {
  savingMarqueeBrand.value = true
  try {
    const brands = [...homepageStore.homepageData.marqueeBrands]
    brands.push({
      ...marqueeBrandForm,
      id: Date.now().toString()
    })
    
    await homepageStore.updateMarqueeBrands(brands)
    showAddMarqueeBrandModal.value = false
    resetMarqueeBrandForm()
    showNotification('success', safeTranslate('Marquee brand added successfully'))
  } catch (error) {
    showNotification('error', safeTranslate('Failed to add marquee brand'))
  } finally {
    savingMarqueeBrand.value = false
  }
}

const deleteMarqueeBrand = async (index: number) => {
  if (!confirm(safeTranslate('Are you sure you want to delete this brand logo?'))) return
  
  const brands = [...homepageStore.homepageData.marqueeBrands]
  brands.splice(index, 1)
  
  try {
    await homepageStore.updateMarqueeBrands(brands)
    showNotification('success', safeTranslate('Marquee brand deleted successfully'))
  } catch (error) {
    showNotification('error', safeTranslate('Failed to delete marquee brand'))
  }
}

const resetMarqueeBrandForm = () => {
  Object.assign(marqueeBrandForm, {
    name: '',
    logo: ''
  })
}

const showNotification = (type: 'success' | 'error', message: string) => {
  window.dispatchEvent(new CustomEvent('luxury-notification', {
    detail: {
      type,
      title: type === 'success' ? safeTranslate('Success') : safeTranslate('Error'),
      message,
      duration: 3000
    }
  }))
}

// Initialize
onMounted(() => {
  loadHomepageData()
})
</script>

<style scoped>
.admin-homepage-management {
  min-height: calc(100vh - 12rem);
}

/* Form styles */
input, select, textarea {
  transition: all 0.2s ease;
}

input:focus, select:focus, textarea:focus {
  outline: none;
  ring-width: 2px;
}

/* Button styles */
button {
  transition: all 0.2s ease-in-out;
}

/* Modal animations */
.fixed {
  animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Grid item hover effects */
.border-gray-200:hover {
  border-color: var(--color-primary-500);
  transform: translateY(-2px);
}

/* Image preview styles */
img {
  transition: transform 0.3s ease;
}

img:hover {
  transform: scale(1.05);
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
  .admin-homepage-management :deep(.bg-white) {
    background-color: #1e293b !important;
  }
  
  .admin-homepage-management :deep(.text-gray-900) {
    color: #f1f5f9 !important;
  }
  
  .admin-homepage-management :deep(.text-gray-700) {
    color: #cbd5e1 !important;
  }
  
  .admin-homepage-management :deep(.text-gray-600) {
    color: #94a3b8 !important;
  }
  
  .admin-homepage-management :deep(.border-gray-200) {
    border-color: #334155 !important;
  }
  
  .admin-homepage-management :deep(.bg-gray-50) {
    background-color: #1e293b !important;
  }
}
</style>